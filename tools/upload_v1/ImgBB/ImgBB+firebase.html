<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ImgBB Upload — Simple UI</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #22d3ee;
      --accent-2: #06b6d4;
      --danger: #f43f5e;
      --ok: #34d399;
      --focus: 0 0 0 3px rgba(34,211,238,0.35);
      --radius: 14px;
    }
    html, body {
      height: 100%;
      background: radial-gradient(1200px 800px at 20% -10%, #0b1220, var(--bg));
      color: var(--text);
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      margin: 0;
    }
    .container { max-width: 720px; margin: 0 auto; padding: 24px; }
    .card {
      background: linear-gradient(180deg, #0b1220, var(--panel));
      border: 1px solid rgba(148,163,184,0.12);
      border-radius: var(--radius);
      box-shadow: 0 20px 60px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.06);
      padding: 20px;
    }
    .row { display: grid; gap: 14px; }
    label { font-weight: 600; font-size: 0.95rem; cursor: pointer; }
    .input {
      display: flex; align-items: center; gap: 10px;
      background: rgba(2,6,23,0.6);
      border: 1px solid rgba(148,163,184,0.18);
      border-radius: 12px; padding: 10px 12px;
    }
    input[type="file"] { display: none; }
    .btns { display: flex; gap: 10px; flex-wrap: wrap; }
    button {
      appearance: none; border: none; color: #00131a;
      background: linear-gradient(180deg, var(--accent), var(--accent-2));
      padding: 10px 14px; border-radius: 12px; font-weight: 700; letter-spacing: 0.2px;
      cursor: pointer; transition: transform 0.06s ease, filter 0.2s ease;
    }
    button:hover { filter: brightness(1.06); }
    button:active { transform: translateY(1px); }
    button:disabled { cursor: not-allowed; filter: grayscale(0.3) brightness(0.8); opacity: 0.7; }
    .btn-secondary { background: linear-gradient(180deg, #2dd4bf, #14b8a6); color: #011410; }
    .btn-ghost { background: transparent; color: var(--text); border: 1px solid rgba(148,163,184,0.22); }
    .status { font-size: 0.92rem; color: var(--muted); min-height: 1.3em; }
    .status.ok { color: var(--ok); }
    .status.err { color: var(--danger); }
    .preview { display: grid; grid-template-columns: 120px 1fr; gap: 14px; align-items: start; }
    .thumb {
      width: 120px; height: 120px; background: rgba(2,6,23,0.6);
      border: 1px solid rgba(148,163,184,0.18); border-radius: 12px; overflow: hidden;
      display: grid; place-items: center; color: var(--muted); font-size: 0.85rem;
    }
    .thumb img { max-width: 100%; max-height: 100%; display: block; }
    .url-box { display: grid; gap: 8px; }
    .loader {
      width: 16px; height: 16px;
      border: 2px solid rgba(255,255,255,0.25); border-top-color: #fff;
      border-radius: 50%; animation: spin 0.8s linear infinite; display: inline-block;
      vertical-align: -3px; margin-right: 8px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    @media (max-width: 560px) {
      .preview { grid-template-columns: 1fr; }
      .thumb { width: 100%; height: 220px; }
    }
    /* Make URL field visible */
    #urlOut {
      display: block; width: 100%; background: transparent; border: none; color: var(--text);
      outline: none;
    }
  </style>
</head>
<body>
  <main class="container">
    <div class="card" role="region" aria-label="ImgBB uploader">
      <div class="row">
        <div class="input">
          <label for="file">Select image</label>
          <input id="file" type="file" accept="image/*" />
          <button class="btn-ghost" id="clearBtn" disabled>Clear</button>
        </div>
      </div>

      <div class="row" style="margin-top: 12px;">
        <div class="preview">
          <div class="thumb" id="thumb" aria-live="polite">No image</div>
          <div class="url-box">
            <div class="btns">
              <button id="uploadBtn" disabled>Upload</button>
              <button id="copyBtn" class="btn-secondary" disabled>Copy URL</button>
              <button id="sendBtn" class="btn-third" disabled>Send URL</button>
            </div>
            <div class="status" id="status" aria-live="polite"></div>
            <div class="row">
              <label for="urlOut">Image URL</label>
              <div class="input">
                <input id="urlOut" type="text" readonly placeholder="URL will appear here after upload" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Optional: tiny helper text -->
      <div class="status" style="margin-top:8px">
        Max ~5 MB recommended. Supported: common image types (png, jpg, webp, gif).
      </div>
    </div>
  </main>

  <script>
    // === Configuration ===
    const IMGBB_API_KEY = '89a7c2fd35b3eb10f59c5a83fc227cff';

    // === Elements ===
    const fileInput = document.getElementById('file');
    const thumb = document.getElementById('thumb');
    const statusEl = document.getElementById('status');
    const urlOut = document.getElementById('urlOut');
    const uploadBtn = document.getElementById('uploadBtn');
    const copyBtn = document.getElementById('copyBtn');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');

    // === State ===
    let selectedFile = null;
    let uploadedUrl = null;

    function setStatus(msg, type = '') {
      statusEl.className = 'status' + (type ? ' ' + type : '');
      statusEl.innerHTML = msg;
    }

    function resetUI() {
      selectedFile = null;
      uploadedUrl = null;
      thumb.innerHTML = 'No image';
      urlOut.value = '';
      uploadBtn.disabled = true;
      copyBtn.disabled = true;
      sendBtn.disabled = true;
      clearBtn.disabled = true;
      setStatus('');
    }

    // Preview handler
    fileInput.addEventListener('change', () => {
      const file = fileInput.files && fileInput.files[0];
      if (!file) {
        resetUI();
        return;
      }

      // Basic validations
      const isImage = file.type.startsWith('image/');
      const tooBig = file.size > 5 * 1024 * 1024; // 5 MB
      if (!isImage) {
        setStatus('Only image files are allowed.', 'err');
        fileInput.value = '';
        return;
      }
      if (tooBig) {
        setStatus('File too large. Try ≤ 5 MB.', 'err');
        fileInput.value = '';
        return;
      }

      selectedFile = file;
      const objUrl = URL.createObjectURL(file);
      thumb.innerHTML = '';
      const img = document.createElement('img');
      img.src = objUrl;
      img.alt = file.name;
      thumb.appendChild(img);

      // Enable actions
      uploadBtn.disabled = false;
      clearBtn.disabled = false;
      setStatus(`Ready to upload: ${file.name}`);
    });

    clearBtn.addEventListener('click', () => {
      fileInput.value = '';
      resetUI();
    });

    // Upload to ImgBB
    uploadBtn.addEventListener('click', async () => {
      if (!selectedFile) return;
      uploadBtn.disabled = true;
      setStatus('<span class="loader"></span>Uploading to ImgBB...');

      try {
        const form = new FormData();
        // ImgBB accepts "image" as binary or base64; binary via FormData works in browser.
        form.append('image', selectedFile);
        form.append('name', selectedFile.name.replace(/\.[^.]+$/, '')); // optional

        const res = await fetch(`https://api.imgbb.com/1/upload?key=${encodeURIComponent(IMGBB_API_KEY)}`, {
          method: 'POST',
          body: form
        });

        if (!res.ok) {
          const text = await res.text().catch(() => '');
          throw new Error(`ImgBB error ${res.status}: ${text || res.statusText}`);
        }

        const data = await res.json();
        // data.data.url is the display page; data.data.image.url or data.data.url? 
        // The direct image URL is often data.data.url or data.data.image.url; prefer display_url or url.
        const directUrl = data?.data?.url || data?.data?.display_url;
        if (!directUrl) throw new Error('No URL returned from ImgBB.');

        uploadedUrl = directUrl;
        urlOut.value = directUrl;
        copyBtn.disabled = false;
        sendBtn.disabled = false;
        setStatus('Upload complete.', 'ok');
      } catch (err) {
        console.error(err);
        setStatus('Upload failed. ' + (err?.message || 'Please try again.'), 'err');
        uploadBtn.disabled = false; // allow retry
      }
    });

    // Copy URL
    copyBtn.addEventListener('click', async () => {
      if (!uploadedUrl) return;
      try {
        await navigator.clipboard.writeText(uploadedUrl);
        setStatus('URL copied to clipboard.', 'ok');
      } catch {
        setStatus('Copy failed. Manually select the URL.', 'err');
      }
    });

    // Simple keyboard UX for label -> input
    document.querySelector('label[for="file"]').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        fileInput.click();
      }
    });

    // On load
    resetUI();
  </script>

  <!-- Firebase: send URL to Realtime Database -->
  <script type="module">
    // Replace with your Firebase config
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
    import { getDatabase, ref, push, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js';

    const firebaseConfig = {
    apiKey: "AIzaSyAQinfTKrG2TWh5YpZt1dB89w1-Ls2btJw",
    authDomain: "my-test-c5cbb.firebaseapp.com",
    projectId: "my-test-c5cbb",
    storageBucket: "my-test-c5cbb.firebasestorage.app",
    messagingSenderId: "1054365782560",
    appId: "1:1054365782560:web:73871594f49935849b2245",
    measurementId: "G-120VRDFCMM"
  };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const sendBtn = document.getElementById('sendBtn');
    const statusEl = document.getElementById('status');
    const urlOut = document.getElementById('urlOut');
    const fileInput = document.getElementById('file');

    function setStatus(msg, type = '') {
      statusEl.className = 'status' + (type ? ' ' + type : '');
      statusEl.innerHTML = msg;
    }

    sendBtn.addEventListener('click', async () => {
      const url = urlOut.value.trim();
      if (!url) {
        setStatus('No URL to send. Upload first.', 'err');
        return;
      }

      // Prepare metadata
      const file = fileInput.files && fileInput.files[0];
      const payload = {
        url,
        name: file ? file.name : null,
        type: file ? file.type : null,
        size: file ? file.size : null,
        createdAt: serverTimestamp()
      };

      sendBtn.disabled = true;
      setStatus('<span class="loader"></span>Sending URL to Firebase...');

      try {
        await push(ref(db, 'images'), payload);
        setStatus('URL saved to Firebase.', 'ok');
      } catch (err) {
        console.error(err);
        setStatus('Failed to save to Firebase. ' + (err?.message || ''), 'err');
      } finally {
        sendBtn.disabled = false;
      }
    });
  </script>
</body>
</html>